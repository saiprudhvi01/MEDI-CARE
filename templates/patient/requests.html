{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">My Medical Requests</h2>
    
    {% if requests %}
    <div class="row">
        {% for r in requests %}
        <div class="col-md-6 mb-4">
            <div class="card {{ 'border-danger' if r.is_ambulance_only else '' }}">
                <div class="card-header d-flex justify-content-between align-items-center {{ 'bg-danger text-white' if r.is_ambulance_only else '' }}">
                    <h5 class="mb-0">
                        {% if r.is_ambulance_only %}
                            ðŸš¨ Emergency Request #{{ r.id }}
                        {% else %}
                            Hospital Request #{{ r.id }}
                        {% endif %}
                    </h5>
                    <span class="badge bg-{{ 'success' if r.status == 'completed' else 'warning' if r.status == 'in_transit' else 'info' if r.status == 'accepted' else 'danger' if r.status == 'rejected' else 'secondary' }}">
                        {{ r.status|replace('_', ' ')|title }}
                    </span>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {% if r.is_ambulance_only %}
                                <h6>Emergency Details</h6>
                                <p class="mb-1"><strong>Location:</strong> {{ r.patient_location_text or 'Not specified' }}</p>
                                <p class="mb-1"><strong>Contact:</strong> {{ r.contact_phone or 'Not provided' }}</p>
                                <p class="mb-1"><strong>Emergency:</strong> {{ r.emergency_description or 'Not specified' }}</p>
                            {% else %}
                                <h6>Hospital Details</h6>
                                <p class="mb-1"><strong>Address:</strong> {{ r.hospital_requests.address if r.hospital_requests else 'Not specified' }}</p>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <h6>Request Details</h6>
                            <p class="mb-1"><strong>Created:</strong> {{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            <p class="mb-1"><strong>Status:</strong> 
                                <span class="badge bg-{{ 'success' if r.status == 'completed' else 'primary' if r.status == 'in_transit' else 'warning' if r.status == 'accepted' else 'secondary' }}">
                                    {{ r.status|replace('_', ' ')|title }}
                                </span>
                            </p>
                            {% if r.accepted_at %}
                            <p class="mb-1"><strong>Accepted at:</strong> {{ r.accepted_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            {% endif %}
                            {% if r.completion_time %}
                            <p class="mb-1"><strong>Completed at:</strong> {{ r.completion_time.strftime('%Y-%m-%d %H:%M') }}</p>
                            {% if r.distance_covered %}
                            <p class="mb-1"><strong>Distance covered:</strong> {{ "%.2f"|format(r.distance_covered) }} km</p>
                            {% endif %}
                            {% if r.time_taken_minutes %}
                            <p class="mb-1"><strong>Time taken:</strong> {{ r.time_taken_minutes }} minutes</p>
                            {% endif %}
                            {% if r.notes %}
                            <p class="mb-1"><strong>Driver notes:</strong> {{ r.notes }}</p>
                            {% endif %}
                            {% endif %}
                            {% if r.status == 'completed' %}
                            <div class="alert alert-success mt-2 mb-0">
                                <i class="fas fa-check-circle me-2"></i>
                                Your request has been completed. Thank you for using our service.
                            </div>
                            {% endif %}
                            {% if r.distance %}
                            <p class="mb-1"><strong>Distance to hospital:</strong> {{ "%.2f"|format(r.distance) }} km</p>
                            {% endif %}
                        </div>
                    </div>
                    {% if r.ambulance_driver %}
                    <div class="alert alert-info mt-3">
                        <h6>Assigned Ambulance</h6>
                        <p class="mb-1"><strong>Driver:</strong> {{ r.ambulance_driver.name }}</p>
                        <p class="mb-1"><strong>Contact:</strong> {{ r.ambulance_driver.phone }}</p>
                        <p class="mb-1"><strong>License:</strong> {{ r.ambulance_driver.license_number }}</p>
                        {% if r.driver_lat and r.driver_lng %}
                        <p class="mb-0">
                            <strong>Ambulance Location:</strong> 
                            <a href="https://www.google.com/maps?q={{ r.driver_lat }},{{ r.driver_lng }}" target="_blank" class="text-primary">
                                View on Map
                            </a>
                        </p>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <div class="mt-3">
                        <h6>Symptoms</h6>
                        <p>{{ r.symptoms or 'No symptoms provided' }}</p>
                    </div>
                    
                    {% if r.notes %}
                    <div class="alert alert-warning mt-3">
                        <h6>Notes</h6>
                        <p class="mb-0">{{ r.notes }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <p class="mb-0">You haven't made any medical requests yet.</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{{ url_for('patient_dashboard') }}" class="btn btn-primary">
            <i class="fas fa-hospital me-2"></i>Find Hospitals
        </a>
        <a href="{{ url_for('patient_dashboard') }}" class="btn btn-danger">
            <i class="fas fa-ambulance me-2"></i>Request Emergency Ambulance
        </a>
    </div>
    {% endif %}
</div>

<style>
    .card {
        height: 100%;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
    }
    h6 {
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}
